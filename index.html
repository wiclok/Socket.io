<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Socket.IO chat</title>
  <link rel="stylesheet" href="/style.css">
</head>

<body>
  <ul id="messages"></ul>
  <form id="form" action="">
    <input id="name" placeholder="Your Name" autocomplete="off" />
    <input id="input" placeholder="Your Message" autocomplete="off" />
    <button>Send</button>
  </form>
  <div id="estadoEscribiendo"></div>
  <script src="/socket.io/socket.io.js"></script>

  <script>
    var socket = io();
    var form = document.getElementById('form');
    var input = document.getElementById('input');
    var nameInput = document.getElementById('name');
    var messages = document.getElementById('messages');
    var typingStatus = document.getElementById('estadoEscribiendo');

    var typing = false;

    // Solicitar historial de mensajes al conectarse
    socket.on('connect', function () {
      socket.emit('solicitar historial');
    });

    // Cargar mensajes del historial
    socket.on('historial de mensajes', function (historial) {
      historial.forEach(function (mensaje) {
        mostrarMensajes(mensaje.name + ': ' + mensaje.message);
      });
    });

    input.addEventListener('input', function () {
      typing = input.value.length > 0;
      socket.emit('typing', { typing: typing, name: nameInput.value });
    });

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      var name = nameInput.value;
      var message = input.value;
      if (name && message) {
        socket.emit('message', { name: name, message: message });
        input.value = '';
      }
    });

    socket.on('message', function (data) {
      mostrarMensajes(data.name + ': ' + data.message);
    });

    socket.on('typing', function (data) {
      if (data.typing) {
        typingStatus.textContent = data.name + ' est√° escribiendo...';
      } else {
        typingStatus.textContent = '';
      }
    });

    function mostrarMensajes(msg) {
      var item = document.createElement('li');
      item.textContent = msg;
      messages.appendChild(item);
      window.scrollTo(0, document.body.scrollHeight);
    }
  </script>
</body>

</html>